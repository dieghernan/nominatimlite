---
output: github_document
editor_options: 
  markdown: 
    wrap: 80
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE,
  tidy = "styler",
  fig.path = "man/figures/README-",
  dpi = 90,
  out.width = "100%"
)
```

# nominatimlite <img src="man/figures/logo.png" align="right" width="120"/>

<!-- badges: start -->

[![R-CMD-check](https://github.com/dieghernan/nominatimlite/actions/workflows/check-full.yaml/badge.svg)](https://github.com/dieghernan/nominatimlite/actions/workflows/check-full.yaml)
[![codecov](https://codecov.io/gh/dieghernan/nominatimlite/branch/main/graph/badge.svg?token=jSZ4RIsj91)](https://codecov.io/gh/dieghernan/nominatimlite)
[![r-universe](https://dieghernan.r-universe.dev/badges/nominatimlite)](https://dieghernan.r-universe.dev/)
[![Project Status: Concept â€“ Minimal or no implementation has been done yet, or
the repository is only intended to be a limited example, demo, or
proof-of-concept.](https://www.repostatus.org/badges/latest/concept.svg)](https://www.repostatus.org/#concept)
[![DOI](https://img.shields.io/badge/DOI-10.5281/zenodo.5113195-blue)](https://doi.org/10.5281/zenodo.5113195)

<!-- badges: end -->

The goal of `nominatimlite` is to provide a light interface for geocoding
addresses, based on the [Nominatim
API](https://nominatim.org/release-docs/latest/). **Nominatim** is a tool to
search [OpenStreetMap](https://www.openstreetmap.org/) data by name and address
([geocoding](https://wiki.openstreetmap.org/wiki/Geocoding "Geocoding")) and to
generate synthetic addresses of OSM points (reverse geocoding).

This package is derived of the much more mature and complete `tidygeocoder`
package by Jesse Cambon ([link](https://jessecambon.github.io/tidygeocoder/)),
that it is available on CRAN.

It also allows to load spatial objects using the `sf` package.

Full site with examples and vignettes on
<https://dieghernan.github.io/nominatimlite>


## Why `nominatimlite`?

Since `tidygecoder` is much more complete, providing access to several geocoder
services as Mapbox, TomTom or Google, the downloading method is based on `curl`.
In some cases, `curl` could not be available, so `nominatimlite` uses an
approach to overcome this limitation.


## Installation

You can install the developing version of `nominatimlite` with:

``` r
devtools::install_github("dieghernan/nominatimlite")
```

Alternatively, you can install `nominatimlite` using the
[r-universe](https://dieghernan.r-universe.dev/ui#builds):

``` r
# Enable this universe
options(repos = c(
    dieghernan = 'https://dieghernan.r-universe.dev',
    CRAN = 'https://cloud.r-project.org'))


install.packages('nominatimlite')
```

## Usage

### Geocoding and reverse geocoding

*Note: examples adapted from `tidygeocoder` package*

In this first example we will geocode a few addresses using the `geo_lite()`
function:

```{r example}
library(tibble)
library(nominatimlite)

# create a dataframe with addresses
some_addresses <- tribble(
  ~name,                  ~addr,
  "White House",          "1600 Pennsylvania Ave NW, Washington, DC",
  "Transamerica Pyramid", "600 Montgomery St, San Francisco, CA 94111",
  "Willis Tower",         "233 S Wacker Dr, Chicago, IL 60606"
)

# geocode the addresses
lat_longs <- geo_lite(some_addresses$addr, lat = "latitude", long = "longitude")
```

Only latitude and longitude are returned from the geocoder service in this
example, but `full_results = TRUE` can be used to return all of the data from
the geocoder service.

```{r echo=FALSE}
knitr::kable(lat_longs)
```

To perform reverse geocoding (obtaining addresses from geographic coordinates),
we can use the `reverse_geo_lite()` function. The arguments are similar to the
`geo_lite()` function, but now we specify the input data columns with the `lat`
and `long` arguments. The dataset used here is from the geocoder query above.
The single line address is returned in a column named by the `address`.

```{r}
reverse <- reverse_geo_lite(
  lat = lat_longs$latitude, long = lat_longs$longitude,
  address = "address_found"
)
```

```{r, echo = FALSE}
knitr::kable(reverse)
```

For more advance users, see [Nominatim
docs](https://nominatim.org/release-docs/latest/api/Search/) to check the
parameters available.

### Spatial objects

With `nominatimlite` you can extract spatial objects easily:

```{r McDonalds}

# Extract some points - McDonalds in Los Angeles

McDonalds <- geo_lite_sf("McDonalds, Los Angeles, CA",
  limit = 20,
  custom_query = list(countrycodes = "us")
)

library(ggplot2)

ggplot(McDonalds) +
  geom_sf()
```

You can also extract polygons using the option `polygon = TRUE`:

```{r penta }

pentagon_poly <- geo_lite_sf("Pentagon", polygon = TRUE)

ggplot(pentagon_poly) +
  geom_sf()
```
